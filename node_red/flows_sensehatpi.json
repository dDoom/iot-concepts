[{"type":"tab","id":"9040230c.6fbfe","label":"SenseHAT pos & move skull"},{"type":"tab","id":"b68a536d.4975b","label":"Flow 1"},{"id":"af380220.50c8","type":"mqtt-broker","z":"9040230c.6fbfe","broker":"192.168.1.30","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willRetain":null,"willPayload":"","birthTopic":"","birthQos":"0","birthRetain":null,"birthPayload":""},{"id":"5d41837c.a2be7c","type":"mqtt-broker","z":"b68a536d.4975b","broker":"192.168.1.29","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willRetain":null,"willPayload":"","birthTopic":"","birthQos":"0","birthRetain":null,"birthPayload":""},{"id":"a4fe522b.5b01b","type":"mqtt out","z":"9040230c.6fbfe","name":"","topic":"/servoshield/1/incoming","qos":"","retain":"","broker":"af380220.50c8","x":664.5,"y":396,"wires":[]},{"id":"db6fa0b4.24906","type":"rpi-sensehat in","z":"9040230c.6fbfe","name":"","motion":true,"env":true,"stick":true,"x":132.5,"y":54,"wires":[["73381868.8cc7e8","bb975142.4468b"]]},{"id":"bb975142.4468b","type":"switch","z":"9040230c.6fbfe","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"joystick","vt":"str"}],"checkall":"true","outputs":1,"x":296.5,"y":159,"wires":[["f78ce58b.087318"]]},{"id":"1bfd51b8.e402ae","type":"rpi-sensehat out","z":"9040230c.6fbfe","name":"","x":630.5,"y":562,"wires":[]},{"id":"ec568108.13a98","type":"function","z":"9040230c.6fbfe","name":"control LED","func":"var X=(flow.get(\"X\")||4)-1;\nvar Y=(flow.get(\"Y\")||3)-1;\n\n\nif(msg.payload.key==\"LEFT\" && (X>0)){\n    X=X-1;\n}\n\nif(msg.payload.key==\"RIGHT\" && (X<7)){\n    X=X+1;\n}\nif(msg.payload.key==\"UP\" && (Y>0)){\n    Y=Y-1;\n}\nif(msg.payload.key==\"DOWN\" && (Y<7)){\n    Y=Y+1;\n}\n\nflow.set(\"X\",X+1);\nflow.set(\"Y\",Y+1);\n\nvar msg1 = { payload:\"*,*,black\" };\nvar msg2 = { payload:util.format(\"%d,%d,red\",X,Y) };\n\nreturn [msg1,msg2];","outputs":"2","noerr":0,"x":478.5,"y":340,"wires":[["1bfd51b8.e402ae"],["1bfd51b8.e402ae"]]},{"id":"f78ce58b.087318","type":"switch","z":"9040230c.6fbfe","name":"","property":"payload.state","propertyType":"msg","rules":[{"t":"neq","v":"0","vt":"num"}],"checkall":"true","outputs":1,"x":267.5,"y":247,"wires":[["ec568108.13a98","7046b819.8fb948"]]},{"id":"7046b819.8fb948","type":"function","z":"9040230c.6fbfe","name":"control skull","func":"var    servoXMin=200; //  The commented numbers are for the old pan/tilt set\nvar    servoXMax=520; // \nvar    servoXMid=330; // 360\nvar    servoYMin=235; //\nvar     servoYMax=520; //\nvar    servoYMid=300; // 320\n\nvar increment=2;\n\nif(msg.payload.key==\"ENTER\"){\n    msg.payload=\"JAW_MOTION, 1, 1\"; \n    return msg;\n}\n\nvar SX=(flow.get(\"SX\"))||servoXMid;\nvar SY=(flow.get(\"SY\"))||servoYMid;\n\nif(msg.payload.key==\"LEFT\" && (SX>servoXMin)){\n    SX=SX-increment;\n}\n\nif(msg.payload.key==\"RIGHT\" && (SX<servoXMax)){\n    SX=SX+increment;\n}\nif(msg.payload.key==\"UP\" && (SY>servoYMin)){\n    SY=SY-increment;\n}\nif(msg.payload.key==\"DOWN\" && (SY<servoYMax)){\n    SY=SY+increment;\n}\n\nflow.set(\"SX\",SX);\nflow.set(\"SY\",SY);\n\nvar msg1 = { payload:util.format(\"SERVOS_MOVE,%d,%d,7\",SX,SY) };\n\nreturn msg1;\n","outputs":1,"noerr":0,"x":347.5,"y":396,"wires":[["a4fe522b.5b01b"]]},{"id":"73381868.8cc7e8","type":"mqtt out","z":"9040230c.6fbfe","name":"","topic":"/sensehat/1/status","qos":"","retain":"","broker":"af380220.50c8","x":678.5,"y":115,"wires":[]},{"id":"9bbf5197.6440b","type":"debug","z":"b68a536d.4975b","name":"","active":true,"console":"false","complete":"payload.acceleration.x","x":540.5,"y":99,"wires":[]},{"id":"5fb9f5a1.a0460c","type":"mqtt in","z":"b68a536d.4975b","name":"","topic":"/sensehat/1/status","broker":"5d41837c.a2be7c","x":136.5,"y":92,"wires":[["9cc07828.633f88"]]},{"id":"9cc07828.633f88","type":"json","z":"b68a536d.4975b","name":"","x":271.5,"y":224,"wires":[["9bbf5197.6440b"]]},{"id":"3a61e2a4.53b39e","type":"http in","z":"9040230c.6fbfe","name":"","url":"/operaen","method":"get","swaggerDoc":"","x":135.5,"y":608,"wires":[["fe8b16e6.dec7f8","45e35ba9.723f84"]]},{"id":"651d80b5.bb25","type":"http response","z":"9040230c.6fbfe","name":"","x":615.5,"y":658,"wires":[]},{"id":"fe8b16e6.dec7f8","type":"change","z":"9040230c.6fbfe","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Liten og rund, triller fort. Venn med R2-D2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":376.5,"y":657,"wires":[["651d80b5.bb25"]]},{"id":"45e35ba9.723f84","type":"change","z":"9040230c.6fbfe","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Mamma padler i den","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":378.5,"y":561,"wires":[["1bfd51b8.e402ae","d61a597c.4152f8"]]},{"id":"d61a597c.4152f8","type":"delay","z":"9040230c.6fbfe","name":"","pauseType":"delay","timeout":"16","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":368.5,"y":506,"wires":[["45e35ba9.723f84"]]}]